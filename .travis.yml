cache:
  directories:
  - $HOME/google-cloud-sdk/
matrix:
  include:
  - os: linux
    dist: trusty
    sudo: required
    compiler: gcc
    addons:
      apt:
        sources:
        - ubuntu-toolchain-r-test
        packages:
        - gcc-5
        - g++-5
        - libpthread-stubs0-dev
        - libgl1-mesa-dev
        - libx11-dev
        - libxrandr-dev
        - libfreetype6-dev
        - libglew1.5-dev
        - libjpeg8-dev
        - libsndfile1-dev
        - libopenal-dev
        - libudev-dev
    env:
    - GAE_PYTHONPATH=${HOME}/.cache/google_appengine PATH=$PATH:${HOME}/google-cloud-sdk/bin
      PYTHONPATH=${PYTHONPATH}:${GAE_PYTHONPATH} CLOUDSDK_CORE_DISABLE_PROMPTS=1
  - os: osx
    osx_image: xcode8.2
language: cpp
before_install:
- openssl aes-256-cbc -K $encrypted_482e2f17cfc1_key -iv $encrypted_482e2f17cfc1_iv
  -in credentials.tar.gz.enc -out credentials.tar.gz -d
- if [[ "$TRAVIS_OS_NAME" == "osx" ]]; then brew update          ; fi
- if [[ "$TRAVIS_OS_NAME" == "osx" ]]; then brew install cmake   ; fi
- if [ ! -d "${GAE_PYTHONPATH}" ]; then python scripts/fetch_gae_sdk.py $(dirname
  "${GAE_PYTHONPATH}"); fi
- if [ ! -d ${HOME}/google-cloud-sdk ]; then curl https://sdk.cloud.google.com | bash;
  fi
- tar -xzf credentials.tar.gz
- mkdir -p lib
- gcloud auth activate-service-account --key-file client-secret.json
install:
- if [[ "$TRAVIS_OS_NAME" != "osx" ]]; then export CXX="g++-5" CC="gcc-5"; fi
- gcloud config set project rtype-server
- gcloud -q components update gae-python
- pip install -r requirements.txt -t lib/
script:
- mkdir build
- cd build
- cmake .. && make
- if [[ "$TRAVIS_OS_NAME" != "osx" ]]; then ctest --verbose   ; fi
- gcloud -q preview app deploy app.yaml --promote
notifications:
  slack: r-type2016:mLsIqykIanE3Yt8cHcLetGuv
